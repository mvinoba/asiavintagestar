<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eventos - Asia Vintage Star</title>
    <!-- Google font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Link to External CSS -->
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <!-- ===== HERO ===== -->
    <header>
      <!-- Aurora bubbles are added via ::before and ::after pseudo-elements -->
      <div class="brand-wrap">
        <a href="index.html">
          <img src="logo3.2.png" alt="Logo Asia Vintage Star" />
        </a>
      </div>
      <nav>
        <a href="eventos.html">eventos</a>
        <span>•</span>
        <a href="entrevistas.html">entrevistas</a>
        <span>•</span>
        <a href="sobre-nos.html">sobre nós</a>
        <span>•</span>
        <a href="seja-voluntario.html">seja voluntário</a>
        <span>•</span>
        <a href="contato.html">contato</a>
      </nav>
      <div class="social-links">
        <a href="https://www.instagram.com/asiavintagestar" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <i class="fa-brands fa-instagram" title="Instagram"></i>
        </a>
        <a href="https://www.facebook.com/asiavintagestar" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
          <i class="fa-brands fa-facebook-f" title="Facebook"></i>
        </a>
        <a href="https://www.tiktok.com/@asiavintagestar" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          <i class="fa-brands fa-tiktok" title="TikTok"></i>
        </a>
      </div>
    </header>

    <!-- ===== GRID ===== -->
    <main>
        <div class="grid">
            <p>Carregando eventos...</p>
            <!-- Posts will be loaded here -->
        </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer>
      © <span id="year"></span> Asia Vintage Star — Todos os direitos
      reservados.
    </footer>

    <!-- Instagram embed loader -->
    <script async src="//www.instagram.com/embed.js"></script>

    <!-- SINGLE SCRIPT BLOCK FOR ALL LOGIC -->
    <script>
      // --- Global Variables & Elements ---
      const grid = document.querySelector('.grid');
      // IMPORTANT: You might need to change this URL or the filtering logic below
      //            to load event-specific posts from your Google Sheet.
      const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwOoUC1FaaexqrEA6CtMnE46b4_5m28gSZUia3sm2mUUZA1EHxF-qHBwMSTFw0aR7o7N9rppNjmFLG/pub?gid=0&single=true&output=csv';
      let intersectionObserver; // Declare observer globally to manage it

      // --- Function to Load Posts from Google Sheet ---
      async function loadInstagramPosts() {
          // grid.innerHTML = '<p>Loading posts...</p>'; // Keep initial message
          try {
              const response = await fetch(sheetUrl);
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              const csvData = await response.text();
              const rows = csvData.split(/\r?\n/).slice(1);
              rows.reverse();
              grid.innerHTML = ''; // Clear loading message

              let postsFound = false;
              rows.forEach(row => {
                  const columns = row.split(',');
                  const postUrl = columns[0] ? columns[0].trim() : null;
                  const isActive = columns[1] && columns[1].trim().toUpperCase() === 'SIM';

                  // *** Potential Filter Area ***
                  // You might add another column check here, e.g., if column 2 indicates "Event"
                  // const postType = columns[2] ? columns[2].trim().toLowerCase() : '';
                  // if (isActive && postType === 'evento' && postUrl && postUrl.startsWith('https://www.instagram.com/')) {

                  if (isActive && postUrl && postUrl.startsWith('https://www.instagram.com/')) {
                      postsFound = true;
                      const card = document.createElement('div');
                      card.className = 'card';

                      const blockquote = document.createElement('blockquote');
                      blockquote.className = 'instagram-media';
                      blockquote.setAttribute('data-instgrm-permalink', postUrl);
                      blockquote.setAttribute('data-instgrm-version', '14');
                      // Add styles for better embed display within card
                      blockquote.style.maxWidth = '100%';
                      blockquote.style.width = '100%';
                      blockquote.style.minWidth = '0';
                      blockquote.style.margin = '0';
                      blockquote.style.padding = '0';
                      blockquote.style.border = 'none';
                      blockquote.style.background = 'transparent';
                      blockquote.style.boxShadow = 'none';
                      blockquote.innerHTML = ' '; // Placeholder content for embed script


                      card.appendChild(blockquote);
                      grid.appendChild(card);
                  }
              });

              if (!postsFound && grid.innerHTML === '') {
                   grid.innerHTML = '<p>Nenhum evento para mostrar no momento.</p>'; // Changed Empty Text
              }

              // Use setTimeout to ensure DOM updates before processing embeds
              setTimeout(() => {
                  if (window.instgrm && window.instgrm.Embeds) {
                      window.instgrm.Embeds.process();
                  }
                  // Setup observer regardless of whether instgrm object is found immediately
                  setupCardObserver();
              }, 100); // Small delay

          } catch (error) {
              console.error('Error loading Instagram posts:', error);
              grid.innerHTML = '<p>Não foi possível carregar os eventos. Verifique sua conexão ou tente novamente mais tarde.</p>'; // Changed Error Text
          }
      }


      // --- Function to Setup Intersection Observer for Card Animations ---
      function setupCardObserver() {
            const cards = document.querySelectorAll('.card:not(.reveal)');
            if (cards.length === 0) return;

            const observerOptions = { root: null, rootMargin: '0px 0px -10% 0px', threshold: 0.1 }; // Trigger slightly earlier

            const observerCallback = (entries, observer) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        const card = entry.target;
                        // Stagger the animation slightly
                        const delay = index * 80; // Reduced delay
                        card.style.transitionDelay = `${delay}ms`;
                        card.classList.add('reveal');

                        // Add 'loaded' class slightly after reveal starts, gives time for potential embed loading
                        // This might need adjustment depending on how fast Instagram embeds load
                        setTimeout(() => {
                            // Check if blockquote has substantial content added by Instagram script
                             const bq = card.querySelector('blockquote');
                            if (bq && bq.clientHeight > 50) { // Check if height changed significantly
                                card.classList.add('loaded');
                             } else {
                                // Fallback: if no embed is loaded after a while, still remove pulse
                                setTimeout(() => card.classList.add('loaded'), 1500);
                            }
                        }, delay + 400); // Adjust timing as needed

                        observer.unobserve(card); // Stop observing once revealed
                    }
                });
            };

            if (intersectionObserver) {
                intersectionObserver.disconnect(); // Disconnect previous observer if exists
            }
            intersectionObserver = new IntersectionObserver(observerCallback, observerOptions);
            cards.forEach(card => intersectionObserver.observe(card));
        }


      // --- Header Shrink on Scroll Logic ---
      let lastScrollY = window.scrollY;
      let ticking = false;
      const handleScroll = () => {
          lastScrollY = window.scrollY;
          if (!ticking) {
              window.requestAnimationFrame(() => {
                  if (lastScrollY > 80) { // Increased threshold
                      document.body.classList.add('scrolled');
                  } else {
                      document.body.classList.remove('scrolled');
                  }
                  ticking = false;
              });
              ticking = true;
          }
      };

      // --- Initial Setup on DOM Load ---
      document.addEventListener('DOMContentLoaded', () => {
          const yearSpan = document.getElementById('year');
          if(yearSpan) { yearSpan.textContent = new Date().getFullYear(); }

          // Explicitly set initial state
          document.body.classList.remove('scrolled');

          // Load posts first
          loadInstagramPosts(); // This function now also calls setupCardObserver after processing

          // Add scroll listener
          window.addEventListener('scroll', handleScroll, { passive: true });

          // Delay initial check to prevent premature header shrinking on iPhones
          setTimeout(() => {
              // Initial check only if page is actually scrolled significantly
              if (window.scrollY > 100) {
                  handleScroll();
              }
          }, 500); // Increased delay to 500ms for better iPhone compatibility
      });
    </script>
  </body>
</html> 